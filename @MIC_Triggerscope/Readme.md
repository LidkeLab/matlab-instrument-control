# MIC_Triggerscope contains methods to control a Triggerscope.
## Description
This class is designed for the control of a Triggerscope (written for
Triggerscope 3B and 4). All functionality present in the Triggerscope
documentation should be included.
EXAMPLE USAGE:
TS = MIC_Triggerscope('COM3', [], true);
This will create an instance of the class and automatically
attempt to connect to serial port COM3.
## REQUIREMENTS:
Triggerscope 3B, Triggerscope 4 (https://arc.austinblanco.com/)
connected via an accessible serial port
MATLAB 2019b or later (for updated serial communications, e.g.,
serialport())
Windows operating system recommended (Unix based systems might
require changes to, e.g., usage/definition of obj.SerialPort,
or perhaps more serious changes)
TeensyDuino serial communication driver installed
http://www.pjrc.com/teensy/serial_install.exe
### Citation: David J. Schodt (Lidke Lab, 2020)
# connectTriggerscope connects to a Triggerscope via a serial port.
This method will attempt to connect to the serial port obj.SerialPort,
which is assumed to be a Triggerscope connected via USB.
Created by:
David J. Schodt (Lidke Lab, 2020)
Update obj.ActivityMessage.
# convertVoltageToBitLevel converts a voltage to a bit level.
This method converts a voltage to the appropriate bit level defined by
Range and Resolution.
EXAMPLE USAGE:
Voltage = 2.3;  volts
Range = [0, 5];  0-5 volts
Resolution = 16;  16 bit resolution
[BitLevel] = convertVoltageToBitLevel(Voltage, Range, Resolution);
BitLevel is calculated as
BitLevel = round(((2^Resolution-1) / abs(diff(Range))) * Voltage)
-> BitLevel = 30146
INPUTS:
Voltage: Voltage that is to be converted to a bit level.
(numeric array, values must be in Range)
Range: Range of voltages spanned by the bits defined by Resolution.
(2x1 array, inclusive bounds)
Resolution: Number of bits used to span the range defined by Range.
(scalar integer >= 1)
OUTPUTS:
BitLevel: BitLevel associated with the input Voltage in Range spanned
by Resolution. (scalar integer >= 0)
Created by:
David J. Schodt (Lidke Lab, 2020)
Validate inputs arguments.
# disconnectTriggerscope disconnects the serialport object obj.Triggerscope
This method will delete the serial port object defined by
obj.Triggerscope.
Created by:
David J. Schodt (Lidke Lab, 2020)
Update obj.ActivityMessage.
# executeArrayProgram sends a list of commands to the Triggerscope.
This method will loop through a set of commands in 'CommandSequence' and
attempt to execute them sequentially.  The primary intention is that
'CommandSequence' will be a cell array of commands generated by the
method obj.generateArrayProgram().
INPUTS:
CommandSequence: A list of commands to be sent to the Triggerscope to
produce the behavior defined by the signals in
obj.SignalArray. (cell array of char array)
FastMode: If used, commands are sent as fast as possible to the
Triggerscope, without pausing or waiting for a response.
(Default = false)
OUTPUTS:
Response: A cell array of char arrays, with each element corresponding
to the Triggerscope's response to a command in
CommandSequence (i.e., Response{ii} is the response from
CommandSequence{ii}). (cell array)
Created by:
David J. Schodt (Lidke Lab, 2021)
Set defaults if needed.
# executeCommand executes the input Command on obj.Triggerscope.
This method will take the command given by Command and attempt to execute
it on the serial port object obj.Triggerscope. The intention is that this
method will do some checks on Command before sending to obj.Triggerscope,
e.g., ensuring it's a valid command.
INPUTS:
Command: An ASCII command to be send to the Triggerscope.
(char array, string)
OUTPUTS:
Response: An ASCII response to Command sent by the Triggerscope.
(string)
Created by:
David J. Schodt (Lidke Lab, 2020)
Ensure the input Command is present in obj.CommandList (even if Command
has additional pre/suffixes, e.g., 'TTL1,1' would be considered valid
since 'TTL' is present in obj.CommandList).
# generateArrayProgram generates a program based on obj.SignalArray.
This method will generate a cell array of char arrays, with each element
being one line of an array program to be sent to the Triggerscope.  The
intention is that this method will convert the user defined SignalArray
into a program that can be sent (line-by-line) to the Triggerscope, which
will produce the desired behavior defined by the SignalArray.
NOTE: CommandSequence won't reflect the zero signals.  The Triggerscope
drives each port to 0 volts at each trigger by default.
INPUTS:
NLoops: Number of times to repeat the signals in SignalArray.
(scalar integer)(Default = 1)
Arm: Boolean to indicate whether or not an ARM command should be
attached to the end of the program.  The ARM command will cause
the program to execute immediately if the trigger signal is
already active. (boolean)(Default = true)
OUTPUTS:
CommandSequence: A list of commands to be sent to the Triggerscope to
produce the behavior defined by the signals in
SignalArray.
(cell array of char array)
Created by:
David J. Schodt (Lidke Lab, 2020)
Define default parameters if needed.
# generateToggleSignal generates a toggling signal array.
This method generates a toggle signal, which is a signal whose "hot"
(true) values indicate a toggle.  A toggle event occurs when a trigger
event occurs at the same time that an odd square wave with period
SignalPeriod toggles from 0 to 1.  For example, if
TriggerSignal = [1, 0, 1, 0, 1, 0, 1], SignalPeriod = 4, and the trigger
is a rising edge (TriggerModeInt = 1), then
ToggleSignal = [1, 0, 0, 0, 1, 0, 0] (note that I treat the first 1 as a
rising edge since doing so makes sense as far as hardware is concerned).
INPUTS:
TriggerSignal: Triggering signal which must be formatted s.t.
each element alternates (e.g., [1, 0, 1, 0], or
[0, 1, 0, 1, 0, 1, 0]).
SignalPeriod: "Period" of the output signal with respect to the
triggering events. For example, SignalPeriod = 2
means that every triggering event toggles
OutputSignal, whereas SignalPeriod = 4 means
every other triggering event toggles
OutputSignal.
TriggerModeInt: Integer specifying the triggering mode.
1: Rising edge
2: Falling edge
3: Change
OUTPUTS:
ToggleSignal: A binary signal with entries of 1 indicating a
trigger event happened at the same time as an odd
square wave with period SignalPeriod would have
toggled from 0 to 1, and with all other entries
set to 0.
Define the toggle signal from the input TriggerSignal. This
will be an array with a 1 at each point the output signal should
be toggled, and a 0 at the rest of the points.
# gui is the GUI method for the MIC_Triggerscope class.
This GUI has several elements which can be used to control a Triggerscope
(see MIC_Triggerscope.m for details).
INPUTS:
GUIParent: The 'Parent' of this GUI, e.g., a figure handle.
(Default = figure(...))
Created by:
David J. Schodt (Lidke lab, 2020)
Create a figure handle for the GUI if needed.
# readResponse will attempt to read a response from the Triggerscope.
This method will try to read a message from the Triggerscope using the
readline() MATLAB method.
Created by:
David J. Schodt (Lidke Lab, 2020)
Read the response from the Triggerscope.
# reset will "reset" the class without forcing user to create new instance.
This method is meant to delete all new information in obj that the user
may have entered, without actually deleting the class (which would
require the user to create a new instance of the class).  In other words,
this method will reset all properties of the class instance obj.  This is
done by creating a new instance of the class and then copying over all of
its properties.
Created by:
David J. Schodt (Lidke Lab, 2020)
Create a new instance of the MIC_Triggerscope class.
# selectVoltageRange determines the best voltage range for the given Signal
This method will look at the voltage range of an analog signal 'Signal'
and determine the smallest voltage range encompassing that signal range.
The range options are selected from the options given in
obj.VoltageRangeOptions.
INPUTS:
Signal: An array whose elements represent voltages to be set on a DAC
port of the Triggerscope.
(numeric array, Nx1 or 1xN)(Units = volts)
OUTPUTS:
VoltageRangeIndex: Index of obj.VoltageRangeOptions (or of
obj.VoltageRangeChar) specifying the voltage range
selected for the input 'Signal'.
(scalar integer)
Created by:
David J. Schodt (Lidke Lab, 2020)
Determine the min. and max. voltages present in 'Signal'.
# setDACRange sets the specified DAC port to the desired voltage range.
This method will set DAC port number 'DACIndex' to the voltage range
specified by 'VoltageRange'.
INPUTS:
DACIndex: The DAC port number you wish to change the voltage of.
(integer in range [1, obj.IOChannels])
VoltageRange: The desired voltage range to be set for DAC port
DACIndex.
(1x2 numeric array which is one of the rows of
obj.VoltageRangeOptions, or scalar defining the index
of the row in obj.VoltageRangeOptions)(Default = [0, 5])
Created by:
David J. Schodt (Lidke Lab, 2020)
Set defaults if needed.
# setDACVoltage sets the specified DAC to the desired voltage.
This method will set DAC port number 'DACIndex' to the voltage specified
by 'Voltage'.
EXAMPLE USAGE:
If 'TS' is a working instance of the MIC_Triggerscope class (i.e., the
Triggerscope has already been connected successfully), you can use this
method to set DAC port 7 to 1.3 Volts as follows:
TS.setDACVoltage(7, 1.3)
INPUTS:
DACIndex: The DAC port number you wish to change the voltage of.
(integer in range [1, obj.IOChannels])
Voltage: The voltage you wish to set DAC port number DACIndex to.
NOTE: If the voltage you set is outside of the current set
range of DAC port number DACIndex, this method will
issue an error.
(float in range defined by obj.VoltageRangeOptions(...
obj.DACStatus(DACIndex).VoltageRangeIndex, :))
Created by:
David J. Schodt (Lidke Lab, 2020)
Validate the inputs.
# setDefaults sets some default properties on a connected Triggerscope.
This method will send several commands to the connected Triggerscope in
an attempt to set a "default" state (e.g., setting all DAC ranges to the
default used in obj.setDACRange()).
Created by:
David J. Schodt (Lidke Lab, 2021)
If a Triggerscope isn't connected, there's nothing to do.
# setTTLState sets the specified TTL to the desired state.
This method will set TTL port number 'TTLIndex' to the state specified by
'State'.
EXAMPLE USAGE:
If 'TS' is a working instance of the MIC_Triggerscope class (i.e., the
Triggerscope has already been connected successfully), you can use this
method to set TTL port 13 HIGH (true, on, hot, ...) with any of
the following commands:
TS.setTTLState(13, 'HIGH')
TS.setTTLState(13, true)
TS.setTTLState(13, 1)
Similarly, you can set TTL port 13 LOW (false, off, cold, ...) with any
of the following commands:
TS.setTTLState(13, 'LOW')
TS.setTTLState(13, false)
TS.setTTLState(13, 0)
You can also toggle the state of TTL port 13 by excluding the second
input:
TS.setTTLState(13)
INPUTS:
TTLIndex: The TTL port number you wish to change the state of.
(integer in range [1, obj.IOChannels])
State: The state you wish to set TTL port number TTLIndex to.
(char array 'LOW', 'HIGH', or any input that can be cast to true
or false)
Created by:
David J. Schodt (Lidke Lab, 2020)
Validate the TTLIndex.
NOTE: I'm doing this first to help with the default setting for 'State'.
# toggleLatch simulates a toggle latch circuit.
This method simulates a toggle latch, meaning that any "hot" (true) value
of ToggleSignal will toggle the value of OutputSignal.
INPUTS:
ToggleSignal: A signal consisting of 0's and 1's, where the 1's
direct a state change in OutputSignal.
InPhase: Boolean indicating whether or not the output is "in
phase" (maybe an abuse of terminology here) with the
input trigger, i.e., OutputSignal(1) = double(InPhase)
OUTPUTS:
OutputSignal: Square wave of 0's and 1's with period
SignalPeriod and length matching TriggerSignal.
Simulate the toggle latch to produce our output signal.
# createTriggeringArray opens a GUI that can create a triggering array.
This method will open a GUI which allows the user to define a
'TriggeringArray', i.e., an array defining a simple DAC/TTL program based
on a trigger signal.
NOTE: The primary intention of this method is to generate the class
SignalStruct (which also defines the dependent property
SignalArray), which is a structure with the following fields (to
define this manually outside of this GUI, you only need to set
'Identifier' and 'Signal'):
NPoints: Number of points in the signal.
InPhase: 1 if the signal starts HIGH, 0 otherwise.
Period: Period of the signal with respect to the trigger, e.g., a
period of 4 means that the signal toggles every other
trigger event.
Range: Range of voltages present in the signal [min., max.].
IsLogical: 1 if the signal is logical (e.g., TTL or trigger)
0 if the signal is analog (e.g., DAC)
Handle: Line handle for the signal in this GUI.
Identifier: char array defining which signal this is (the trigger
is 'trigger', TTL's will be 'TTL' suffixed with port
number of field width 2, e.g., 'TTL07', DAC's will be
'DAC' suffixed with port number of field width 2, e.g.,
'DAC03').
Alias: Recognizable char array defining what this signal is meant
to control, e.g., 'laser 405', 'attenuator', ...
Signal: Numeric array containing the signal, e.g., a DAC signal
might be something like [0, 5, 0, 2.5, 0, 5]
INPUTS:
GUIParent: The 'Parent' of this GUI, e.g., a figure handle.
(Default = figure(...))
Created by:
David J. Schodt (Lidke Lab, 2020)
Create a figure handle for the GUI if needed.
# writeCommand writes an ASCII command to the Triggerscope.
This method will send the ASCII command given by Command to the
Triggerscope. This is done using the MATLAB method writeline().
INPUTS:
Command: Properly formatted ASCII command to be send to the
Triggerscope directly. (char array, string)
Created by:
David J. Schodt (Lidke Lab, 2020)
Send the command to the Triggerscope.
